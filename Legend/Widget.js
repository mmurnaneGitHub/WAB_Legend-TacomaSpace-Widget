define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on ./Utils ./d3 esri/layers/FeatureLayer esri/Color esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/renderers/SimpleRenderer esri/graphic dojo/_base/array esri/InfoTemplate esri/geometry/Point dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/LayerInfos/LayerInfos esri/dijit/Legend".split(" "),function(H,h,I,p,q,J,y,r,t,z,A,B,v,K,w,L,M,N,O){return H([M,L],{name:"Legend",baseClass:"jimu-widget-legend",legend:null,_jimuLayerInfos:null,
startup:function(){function g(){response=JSON.parse('{"items":'+JSON.stringify(l)+"}");var c=[];v.forEach(response.items,function(a){var e={};e.PropertyId=a.PropertyId;e.ListingID=a.ListingID;e.PropertyType=a.PropertyType;e.StreetNumber1=a.StreetNumber1;e.StreetName=a.StreetName;e.PropertyName=a.PropertyName;e.ListingType=a.ListingType;e.WebRemarks=a.WebRemarks;a=new w({x:a.Longitude,y:a.Latitude,spatialReference:{wkid:4326}});a=new B(a);a.setAttributes(e);c.push(a)});k.applyEdits(c,null,null);1E3<
screen.width&&k.setFeatureReduction({type:"cluster",clusterRadius:60});f.setVisibility(!1)}function x(c,a){response=JSON.parse('{"items":'+JSON.stringify(a)+"}");f.clear();var e=[],d=response.items.length+" Selected Properties";v.forEach(response.items,function(b){var a={};a.PropertyId=b.PropertyId;a.ListingID=b.ListingID;a.PropertyType=b.PropertyType;a.BuildingTotalSquareFeet=b.BuildingTotalSquareFeet;a.LandTotalSquareFeet=b.LandTotalSquareFeet;a.ListPrice=b.ListPrice;a.SquareFeetAvailable=b.SquareFeetAvailable;
a.AskingRent=b.AskingRent;a.StreetNumber1=b.StreetNumber1;a.StreetName=b.StreetName;a.PropertyName=b.PropertyName;a.ListingType=b.ListingType;a.WebRemarks=b.WebRemarks;a.PrimaryAgentFirstName=b.PrimaryAgentFirstName;a.PrimaryAgentLastName=b.PrimaryAgentLastName;a.PrimaryAgentPhone=b.PrimaryAgentPhone;a.PrimaryAgentEmail=b.PrimaryAgentEmail;var c=new w({x:b.Longitude,y:b.Latitude,spatialReference:{wkid:4326}});c=new B(c);c.setAttributes(a);e.push(c);d+="<hr color='#acb1db'><br>";d+="<b>"+b.PropertyName+
"</b><br>";d+="<img src='http://www.commercialmls.com/Media/Property/thumb/"+b.PropertyId+".jpg' width='100'><br>";d+="<b>Property Type: </b>"+b.PropertyType+"<br>";0<b.BuildingTotalSquareFeet&&(d+="<b>Building: </b>"+u(b.BuildingTotalSquareFeet)+" SF<br>");0<b.LandTotalSquareFeet&&(d+="<b>Lot: </b>"+u(b.LandTotalSquareFeet)+" SF<br>");0<b.ListPrice&&(d+="<b>List Price : </b>$"+u(b.ListPrice)+"<br>");0<b.SquareFeetAvailable&&(d+="<b>Available: </b>"+u(b.SquareFeetAvailable)+" SF<br>");0<b.AskingRent&&
(d+="<b>Rent : </b>$"+parseFloat(b.AskingRent).toFixed(2)+"<br>");d+="<b>Description: </b>"+b.WebRemarks+"<br>";d+="<b>Address: </b>"+b.StreetNumber1+" "+b.StreetName+"<br>";d+="<b>Agent: </b>"+b.PrimaryAgentFirstName+" "+b.PrimaryAgentLastName+"<br>";0<b.PrimaryAgentPhone.length&&(d+="<b>Phone: </b>"+b.PrimaryAgentPhone.slice(0,3)+"."+b.PrimaryAgentPhone.slice(3,6)+"."+b.PrimaryAgentPhone.slice(6,10)+"<br>");d+="<b>Email: </b><a href='mailto:"+b.PrimaryAgentEmail+"'>"+b.PrimaryAgentEmail+"</a><br>";
d+="<b>More information: </b><a target='_blank' href='https://www.commercialmls.com/Search/Index/?st1=&st2=&stpfx=&sname=&stsfx=&city=&st=&zip=&pNum=&co=&add=&rad=-1&crad=&type=2&lpMinHold=&lpMaxHold=&lpMin=&lpMax=&sfMinHold=&sfMaxHold=&sfMin=&sfMax=&soldMinHold=&soldMaxHold=&soldMin=&soldMax=&stat=7%7C1%7C8%7C3%7C2&ptype=&pCat=&busCats=&asfMin=&asfMax=&alsfMin=&alsfMax=&lsfMin=&lsfMax=&bsfMin=&bsfMax=&ma=&lat=&lng=&clat=&clng=&zm=&el=&ps=&sort=-1&id=1&maptype=&cbaid="+b.ListingID+"&wid=25' >CBA Website</a><br>";
d+="<b><a href='javascript:void(0);'  id='"+b.ListingID+"' >Zoom to</a></b><br>&nbsp;<br>"});f.applyEdits(e,null,null);f.setVisibility(!0);document.getElementById("queryResults").innerHTML=d;v.forEach(response.items,function(b){var a=new w({x:b.Longitude,y:b.Latitude,spatialReference:{wkid:4326}});p(document.getElementById(""+b.ListingID),"click",function(){c.centerAndZoom(esri.geometry.geographicToWebMercator(new esri.geometry.Point(a)),19)})})}function u(c){return c?c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
","):0}this.inherited(arguments);var q=this.map.extent,l,C,D,E;J.csv("data/CBA_Download.csv",function(c){l=c.filter(function(a){return"Tacoma"==a.City&&0>a.Longitude&&0<a.Latitude});g();C=l.filter(function(a){return"For Lease"==a.ListingType});D=l.filter(function(a){return"For Sale"==a.ListingType&&"Land"==a.PropertyType});E=l.filter(function(a){return"For Sale"==a.ListingType&&"Land"!=a.PropertyType})});var m=new r([0,151,51,.5]);m=new z("solid",25,new t(t.STYLE_SOLID,new r([89,95,35]),1),m);m=new A(m);
var n=new r([255,255,0,.25]);n=new z("solid",25,new t(t.STYLE_SOLID,new r([89,95,35]),1),n);n=new A(n);var F=new K("TacomaSpace.com","<b> ${PropertyName} </b><br> <img src='http://www.commercialmls.com/Media/Property/thumb/${PropertyId}.jpg' width='100'><br> <i> ${StreetNumber1}  ${StreetName} </i><br> <b> ${ListingType} - ${PropertyType}  </b><br> ${WebRemarks}<br> <b>More information:</b> <a target='_blank' href='https://www.commercialmls.com/Search/Index/?st1=&st2=&stpfx=&sname=&stsfx=&city=&st=&zip=&pNum=&co=&add=&rad=-1&crad=&type=2&lpMinHold=&lpMaxHold=&lpMin=&lpMax=&sfMinHold=&sfMaxHold=&sfMin=&sfMax=&soldMinHold=&soldMaxHold=&soldMin=&soldMax=&stat=7%7C1%7C8%7C3%7C2&ptype=&pCat=&busCats=&asfMin=&asfMax=&alsfMin=&alsfMax=&lsfMin=&lsfMax=&bsfMin=&bsfMax=&ma=&lat=&lng=&clat=&clng=&zm=&el=&ps=&sort=-1&id=1&maptype=&cbaid=${ListingID}&wid=25' >CBA Website</a> "),
G={layerDefinition:{geometryType:"esriGeometryPoint",objectIdField:"ObjectID",fields:[]},featureSet:{features:[],geometryType:"esriGeometryPoint"}};var k=new y(G,{infoTemplate:F});k.title="Available Commercial Properties";k.setRenderer(m);var f=new y(G,{infoTemplate:F});f.title="Available Commercial Properties (filtered)";f.setRenderer(n);this.map.addLayers([k]);this.map.addLayers([f]);f.setVisibility(!1);document.getElementById("filter").addEventListener("change",h.hitch(this,function(c){"All"===
c.target.value?(this.map.setExtent(q),k.setVisibility(!0),f.setVisibility(!1),document.getElementById("queryResults").innerHTML=""):(k.setVisibility(!1),"Lease"===c.target.value?h.hitch(this,x(this.map,C)):"SaleBuilding"===c.target.value?h.hitch(this,x(this.map,E)):h.hitch(this,x(this.map,D)))}))},onOpen:function(){this._jimuLayerInfos=N.getInstanceSync();var g={arrangement:this.config.legend.arrangement,autoUpdate:this.config.legend.autoUpdate,respectCurrentMapScale:this.config.legend.respectCurrentMapScale,
map:this.map,layerInfos:this._getLayerInfosParam()};this.legend=new O(g,I.create("div",{},this.domNode));this.legend.startup();this._bindEvent();g=document.createElement("div");g.innerHTML='<div id="queryResults"></div>';this.domNode.parentNode.insertBefore(g,this.domNode.nextSibling)},onClose:function(){this.legend.destroy();this.map.setExtent(this.map._initialExtent);this.map._layers.graphicsLayer3.setVisibility(!1);this.map._layers.graphicsLayer2.setVisibility(!0);document.getElementById("queryResults").innerHTML=
"";document.getElementById("filter").options[0].selected=!0},_bindEvent:function(){this.config.legend.autoUpdate&&(this.own(p(this._jimuLayerInfos,"layerInfosIsShowInMapChanged",h.hitch(this,"refreshLegend"))),this.own(p(this._jimuLayerInfos,"layerInfosChanged",h.hitch(this,"refreshLegend"))),this.own(p(this._jimuLayerInfos,"layerInfosRendererChanged",h.hitch(this,"refreshLegend"))))},_getLayerInfosParam:function(){return void 0===this.config.legend.layerInfos?q.getLayerInfosParam():q.getLayerInfosParamByConfig(this.config.legend)},
refreshLegend:function(){var g=this._getLayerInfosParam();this.legend.refresh(g)}})});